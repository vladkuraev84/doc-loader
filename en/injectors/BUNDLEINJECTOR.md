## BundleInjector

_src/injectors/bundle-injector.ts_

{% hint style="tip" %}
Класс **BundleInjector** предназначен для добавления бандла (пакета `next-form.js) в веб-страницу на основе определенных параметров и условий. В этом разделе будет разъяснено, как класс  работает и какие методы и свойства он содержит.
{% endhint %}

### Поля класса

| Название    | Префикс           | Описание                                                           |
|-------------|-------------------|--------------------------------------------------------------------|
| **domKey**  | private readonly  | `'main-bundle'` - название ID `<script id='main-bundle'></script>` |


### Конструктор класса

Конструктор класса **BundleInjector** выполняется при создании экземпляра класса. Он принимает массив параметров **[params](../params-worker/PARAMSWORKERTYPES.md)**, представляющих параметры формы. Описание действий, выполняемых в конструкторе:

| Метод / Класс                                   | Описание метода                                                                                                                                                                                                                               |
|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ParamsWorker.hasAnyDevParam(params)**         | проверяет наличие параметров на режим `dev` ([data-dev](../params-worker/PARAMSWORKERTYPES.md)). Если есть данный параметр, подключение бандла не выполняется. Использование параметра режима `dev` означает, что проект локально развернут в режиме разработки. |
| **BundleInjectorDom.isLoaded()**                | проверяет, был ли уже добавлен скрипт на страницу. При наличии `script` в узле [filesContainerId](../CONFIG.md) - дополнительная загрузка файлов не выполняется.                                                                              |
| **ParamsWorker.getAnyInitContentPath(params)**  | получает путь инициализации контента: `data-path=""` в виджете (player). В случае отсутствия пути будет выполнено подключение бандла по умолчанию с помощью метода класса [injectDefaultBundle()](#injectDefaultBundle).                      |
| **Bundler**                                     | если путь инициализации контента определен, то класс [Bundler](injectors/BUNDLER.md) используется для получения локального URL бандла. Затем генерируется и добавляется узел DOM со скриптом с этим URL.                                      |

### Методы класса {#injectDefaultBundle}

| Название                      | Префикс | Описание метода                                                                                                                                                                                                                                                                    |
|-------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **generateScript(bundleUrl)** | private | создает и возвращает элемент **script** для инъекции. Принимает `bundleUrl` - URL бандла, и устанавливает соответствующие атрибуты для этого элемента, такие как `type`, `id`, и `src`. Также он устанавливает обработчик ошибки для случаев, когда скрипт не может быть загружен. |
| **injectDefaultBundle()**     | private | в случае, если не удается найти бандл в локальном пути, будет использован бандл по умолчанию. Метод создает и вставляет скрипт этого бандла, а также выводит предупреждение в консоль.                                                                                             |
| **handleError(error)**        | private | вызывается при возникновении ошибки при загрузке скрипта. Он удаляет ошибочный скрипт и затем вставляет бандл по умолчанию. Также, он выводит предупреждение в консоль, сообщая о проблеме с загрузкой бандла.                                                                     |
| **showWarn(localPath)**       | private | выводит предупреждение в консоль, сообщая о том, что бандл не был найден в локальном пути, и вместо этого используется бандл с сервера.                                                                                                                                            |

### Импорты

В начале кода видны импорты различных модулей и классов. Эти импорты описаны в других разделах и представляют собой зависимости этого класса.

```js
import {Bundler} from '@/bundler';
import {ParamsWorker} from '@/params-worker';
import {DomService} from './dom.service';
import type {FormParams} from '@/params-worker/types';
```